<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Post Message</title>
		<meta charset=utf-8>
		<meta name="viewport" content="width=760">
		<link rel="stylesheet" href="styles/wrapper.css" type="text/css" />
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/h5utils.js"></script>
		<!--[if IE]>
			<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
		<!--[if lte IE 7]>
			<script src="js/IE8.js" type="text/javascript"></script><![endif]-->
		<!--[if lt IE 7]>
			<link rel="stylesheet" type="text/css" media="all" href="css/ie6.css"/><![endif]-->
	</head>
	<body class="content">
		<aside class="body wrapper">
			<article>
				<h2>Wrapper Form</h2>
				<h3 id="receivedMessage"></h3>
				<form>
					<p><input type="text" name="message" class="message" value="Send a message..." id="message" /> <input type="submit" value="Send message"/>
					</p>
				</form>
			</article>
		</aside>
		<section class="body embed">
			<article>
				<hgroup>
					<h2>IFrame</h2>
					<h3>Angular content embedded below:</h3>
				</hgroup>
				<iframe id="iframe" src="http://localhost:9000/#/"></iframe>
			</article>
		</section>
		<script>
			var win = document.getElementById("iframe").contentWindow;
			var h3Label = "Received a message from IFrame:";
			win.onload = function() {
				win.postMessage('connect', '*');
				updateReceivedText("");
			}
			addEvent(window, 'message', function (e) {
				var response = $.parseJSON(e.data);
				updateReceivedText("status = "+response.status+" message = "+response.message);
			});
			addEvent(document.querySelector('form'), 'submit', function (e) {
				var message = JSON.stringify({message: document.getElementById("message").value});
				win.postMessage(message, '*');
				clearText();
				if (e.preventDefault)
				e.preventDefault();
				e.returnValue = false;
			});
			addEvent(document.getElementById("message"), 'click', function (e) {
				clearText();
			});
			function updateReceivedText(message) {
				document.getElementById("receivedMessage").innerHTML = h3Label+" "+message;
			}
			function clearText() {
				document.getElementById("message").value="";
			}
		</script>
	</body>
</html>